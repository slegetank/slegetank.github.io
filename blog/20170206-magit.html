<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2018-09-16 Sun 20:33 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<title>Magit - MagicGitTool for Emacs</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="slegetank" />
<link rel="stylesheet" type="text/css" href="../static/org.css" />
</head>
<body>
<div id="preamble" class="status">
<div id="header">
  <h1>Slegtank's Blog</h1>
  <ul id="nav">
      <li><a href="https://gitlab.com/slegetank">GitLab</a></li>
    <li><a href="https://github.com/slegetank/">Github</a></li>
    <li><a href="../tag.html">Tags</a></li>
    <li><a href="../archive.html">Archive</a></li>
    <li><a href="../index.html">Home</a></li>
  </ul>
</div>
</div>
<div id="content">
<h1 class="title">Magit - MagicGitTool for Emacs</h1>

<div id="outline-container-org70d7b27" class="outline-2">
<h2 id="org70d7b27">为什么</h2>
<div class="outline-text-2" id="text-org70d7b27">
<ul class="org-ul">
<li>emacs内置，可以与文件编辑无缝操作。<br /></li>
<li>相比于命令行，对于提交内容的编辑操作更方便。<br /></li>
</ul>

<p>
当然，相比于现在流行的一些git客户端，magit还是没有什么特别的优势，特别是对于大量文件的merge会出现卡顿的现象。但就像emacs每个其他的功能一样，如果你不是emacser，那么这就不是必须；否则就是你很好的帮手。<br />
</p>

<p>
本文将关注Magit在具体使用上的内容，而不会过多牵涉git的知识。<br />
</p>
</div>
</div>

<div id="outline-container-org7c8812d" class="outline-2">
<h2 id="org7c8812d">安装及配置</h2>
<div class="outline-text-2" id="text-org7c8812d">
<p>
配置依然按照我的习惯：<br />
</p>
<ul class="org-ul">
<li>使用package管理包<br /></li>
<li>vi键位<br /></li>
<li>使用leader键<br /></li>
</ul>

<p>
所以：<br />
将magit、evil-magit加入package-selected-packages，并将status页面绑定到gs按键上:<br />
</p>
<div class="org-src-container">
<pre class="src src-sh">(require <span style="color: #7bc275;">'evil-magit)</span>
<span style="color: #7bc275;">(evil-leader/set-key "gs" '</span>magit-status)
</pre>
</div>
<p>
这样，环境就配置完了。(evil-magit：<a href="https://github.com/justbur/evil-magit">https://github.com/justbur/evil-magit</a>， 将magit适配了evil)<br />
</p>
</div>
</div>
<div id="outline-container-org03570b2" class="outline-2">
<h2 id="org03570b2">git status</h2>
<div class="outline-text-2" id="text-org03570b2">
<p>
M-x magit-status或 空格+gs打开status页面，q退出。<br />
status页面是magit的入口，其作用相当于git status，可以看到对比图：<br />
<img src="../static/20170206-magit-1.png" alt="20170206-magit-1.png" /><br />
</p>

<p>
看起来差不多。但是magit提供了更方便的方式来对文件的修改进行访问以及操作。<br />
</p>
</div>
<div id="outline-container-org2051798" class="outline-3">
<h3 id="org2051798">访问</h3>
<div class="outline-text-3" id="text-org2051798">
<p>
每类文件都有4个展示等级，快捷键分别为1 2 3 4 :<br />
<img src="../static/20170206-magit-2.gif" alt="20170206-magit-2.gif" /><br />
</p>

<p>
其中2（展示文件层）和4（展示修改细节）常用。<br />
</p>

<p>
通过j k上下移动光标(C-j C-k按块移动光标)，在文件上（或任何上一级项上）按tab将会展示其细节。<br />
</p>
</div>
</div>
<div id="outline-container-org904db29" class="outline-3">
<h3 id="org904db29">操作</h3>
<div class="outline-text-3" id="text-org904db29">
<p>
具体见<a href="https://github.com/justbur/evil-magit">evil-magit</a>， 这里只列出常用的一部分：<br />
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">快捷键</td>
<td class="org-left">功能</td>
</tr>

<tr>
<td class="org-left">s/u</td>
<td class="org-left">stage/unstage</td>
</tr>

<tr>
<td class="org-left">c</td>
<td class="org-left">commit</td>
</tr>

<tr>
<td class="org-left">p</td>
<td class="org-left">push</td>
</tr>

<tr>
<td class="org-left">x</td>
<td class="org-left">discard</td>
</tr>

<tr>
<td class="org-left">X</td>
<td class="org-left">untrack</td>
</tr>

<tr>
<td class="org-left">v</td>
<td class="org-left">select</td>
</tr>

<tr>
<td class="org-left">b</td>
<td class="org-left">branch</td>
</tr>

<tr>
<td class="org-left">fu</td>
<td class="org-left">fetch</td>
</tr>

<tr>
<td class="org-left">Fu</td>
<td class="org-left">pull</td>
</tr>

<tr>
<td class="org-left">r/ru</td>
<td class="org-left">rebase</td>
</tr>

<tr>
<td class="org-left">o/O</td>
<td class="org-left">reset</td>
</tr>

<tr>
<td class="org-left">i</td>
<td class="org-left">ignore</td>
</tr>

<tr>
<td class="org-left">zz/zp</td>
<td class="org-left">stash</td>
</tr>

<tr>
<td class="org-left">l</td>
<td class="org-left">log</td>
</tr>

<tr>
<td class="org-left">gr</td>
<td class="org-left">refresh</td>
</tr>

<tr>
<td class="org-left">$</td>
<td class="org-left">show git code</td>
</tr>

<tr>
<td class="org-left">m</td>
<td class="org-left">merge</td>
</tr>

<tr>
<td class="org-left">AA</td>
<td class="org-left">cherry-pick</td>
</tr>
</tbody>
</table>

<p>
下面分别进行描述(对于像cc这种两个按键的，实际上是有popup提示的，所以记不住也没关系)：<br />
</p>
</div>
<div id="outline-container-org88fe931" class="outline-4">
<h4 id="org88fe931">stage/unstage</h4>
<div class="outline-text-4" id="text-org88fe931">
<p>
直接对文件进行stage/unstage，即对文件进行s/u：<br />
<img src="../static/20170206-magit-3.gif" alt="20170206-magit-3.gif" /><br />
</p>

<p>
对块进行stage/unstage，即对块进行s/u:<br />
<img src="../static/20170206-magit-4.gif" alt="20170206-magit-4.gif" /><br />
</p>
</div>
</div>
<div id="outline-container-org45704d1" class="outline-4">
<h4 id="org45704d1">commit/push</h4>
<div class="outline-text-4" id="text-org45704d1">
<p>
stage完之后，按cc进行提交，此时会打开新的buffer，在其中编写commit message，C-c C-c提交，C-c C-k取消。<br />
cc - commit<br />
ca - amend<br />
</p>
</div>
</div>
<div id="outline-container-org7a0af94" class="outline-4">
<h4 id="org7a0af94">select</h4>
<div class="outline-text-4" id="text-org7a0af94">
<p>
magit允许同时对多项进行操作：<br />
<img src="../static/20170206-magit-5.gif" alt="20170206-magit-5.gif" /><br />
</p>
</div>
</div>

<div id="outline-container-org9220f85" class="outline-4">
<h4 id="org9220f85">branch</h4>
<div class="outline-text-4" id="text-org9220f85">
<p>
bb - checkout<br />
bc - checkout new branch<br />
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-orgec9a269" class="outline-2">
<h2 id="orgec9a269">git log</h2>
<div class="outline-text-2" id="text-orgec9a269">
<p>
在status页面按ll就进入了log页面，大概相当于<br />
</p>
<div class="org-src-container">
<pre class="src src-sh">git log --format=<span style="color: #7bc275;">"%h * %s %an %ar"</span>
</pre>
</div>

<p>
在每个提交上，按回车就可以查看这个提交的详细信息，大概相当于<br />
</p>
<div class="org-src-container">
<pre class="src src-sh">git show xxx --pretty=fuller
</pre>
</div>

<p>
1-4对于这个页面也同样有效。<br />
</p>
</div>

<div id="outline-container-org4ac8eae" class="outline-3">
<h3 id="org4ac8eae">操作</h3>
<div class="outline-text-3" id="text-org4ac8eae">
</div>
<div id="outline-container-org47d63e2" class="outline-4">
<h4 id="org47d63e2">log</h4>
<div class="outline-text-4" id="text-org47d63e2">
<p>
git log相对于git status功能上需要更多的对于查询的侧重，而log页面也有丰富的参数可供使用：<br />
<img src="../static/20170206-magit-7.png" alt="20170206-magit-7.png" /><br />
从"~/.emacs.d/elpa/magit-20170203.1633/magit-log.el"中可以看到每个选项对应的实际命令行参数：<br />
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #C57BDB;">:switches</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>?g <span style="color: #7bc275;">"Show graph"</span>              <span style="color: #7bc275;">"--graph"</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>?c <span style="color: #7bc275;">"Show graph in color"</span>     <span style="color: #7bc275;">"--color"</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>?d <span style="color: #7bc275;">"Show refnames"</span>           <span style="color: #7bc275;">"--decorate"</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>?S <span style="color: #7bc275;">"Show signatures"</span>         <span style="color: #7bc275;">"--show-signature"</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>?u <span style="color: #7bc275;">"Show diffs"</span>              <span style="color: #7bc275;">"--patch"</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>?s <span style="color: #7bc275;">"Show diffstats"</span>          <span style="color: #7bc275;">"--stat"</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>?h <span style="color: #7bc275;">"Show header"</span>             <span style="color: #7bc275;">"++header"</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>?D <span style="color: #7bc275;">"Simplify by decoration"</span>  <span style="color: #7bc275;">"--simplify-by-decoration"</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>?f <span style="color: #7bc275;">"Follow renames when showing single-file log"</span> <span style="color: #7bc275;">"--follow"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
<span style="color: #C57BDB;">:options</span>  <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>?n <span style="color: #7bc275;">"Limit number of commits"</span> <span style="color: #7bc275;">"-n"</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>?f <span style="color: #7bc275;">"Limit to files"</span>          <span style="color: #7bc275;">"-- "</span> magit-read-files<span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>?a <span style="color: #7bc275;">"Limit to author"</span>         <span style="color: #7bc275;">"--author="</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>?o <span style="color: #7bc275;">"Order commits by"</span>        <span style="color: #7bc275;">"++order="</span> magit-log-select-order<span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>?g <span style="color: #7bc275;">"Search messages"</span>         <span style="color: #7bc275;">"--grep="</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>?G <span style="color: #7bc275;">"Search changes"</span>          <span style="color: #7bc275;">"-G"</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>?S <span style="color: #7bc275;">"Search occurrences"</span>      <span style="color: #7bc275;">"-S"</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>?L <span style="color: #7bc275;">"Trace line evolution"</span>    <span style="color: #7bc275;">"-L"</span> magit-read-file-trace<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
只要按-g或者=n等，就可以设置、取消这些参数了。对于查询某个文件的历史、某个提交者的历史来说都非常方便。<br />
</p>
</div>
</div>

<div id="outline-container-orgdb72102" class="outline-4">
<h4 id="orgdb72102">rebase interactive</h4>
<div class="outline-text-4" id="text-orgdb72102">
<p>
即git rebase -i，magit里变得稍微方便了一点:<br />
<img src="../static/20170206-magit-6.gif" alt="20170206-magit-6.gif" /><br />
</p>

<p>
在log页面选择squash开始的commit，然后流程跟命令行也差不多。<br />
</p>
</div>
</div>

<div id="outline-container-orgb02d3b3" class="outline-4">
<h4 id="orgb02d3b3">reset</h4>
<div class="outline-text-4" id="text-orgb02d3b3">
<p>
log页面另一个主要功能就是代码回滚了：<br />
<img src="../static/20170206-magit-7.gif" alt="20170206-magit-7.gif" /><br />
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org049179b" class="outline-2">
<h2 id="org049179b">参考资料</h2>
<div class="outline-text-2" id="text-org049179b">
<ul class="org-ul">
<li>官方文档：<a href="https://magit.vc/manual/magit/index.html#Top">https://magit.vc/manual/magit/index.html#Top</a><br /></li>
<li>官方常用功能文档：<a href="https://magit.vc/manual/magit-refcard.pdf">https://magit.vc/manual/magit-refcard.pdf</a><br /></li>
<li>spacemacs git layer文档：<a href="https://github.com/syl20bnr/spacemacs/tree/master/layers/+source-control/git#quick-guide-for-recurring-use-cases-in-magit">https://github.com/syl20bnr/spacemacs/tree/master/layers/+source-control/git#quick-guide-for-recurring-use-cases-in-magit</a><br /></li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
<hr />

                <p>License: <a href= "https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a></p>

                <p><a href= "mailto:slegetank@163.com"> Contact</a></p>
</div>
</body>
</html>
